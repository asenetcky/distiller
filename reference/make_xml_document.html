<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create an XML document with user-provided data and submission metadata — make_xml_document • distiller</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create an XML document with user-provided data and submission metadata — make_xml_document"><meta name="description" content="This is the core function of distiller. It takes in a user-provided
dataframe with the expected columns and a set of metadata about the
submission. It then jumps through the XML hoops for the user and distills it
all down to an XML document that can be submitted to the CDC's EPHT
submission portal. Users should always check the outputs with the EPHT test
submission portal first.
Users are expected to start with a standard dataframe because the XML
requirements change based on the facility type (Hospital vs Emergency
Department) even though the variables and disease are the same. Users trade
some freedom in naming conventions and in return distiller abstracts away
the xml naming gymnastics. By having a single set of column names, users can
keep all their data in one place and do all the required wrangling on a
single set of data, all at once, and then use whatever package they wish to
split out the master data and iterate over it with distiller.
Users have the option to check their submission at time of XML creation and
get instant feedback on the possible validity of their submission. Users can
further refine the returned xml document with their choice of package such as
xml2,
XML and friends.
When satisfied with the data product users will need to print the XML
document to a file and then submit to the CDC like they usually would."><meta property="og:description" content="This is the core function of distiller. It takes in a user-provided
dataframe with the expected columns and a set of metadata about the
submission. It then jumps through the XML hoops for the user and distills it
all down to an XML document that can be submitted to the CDC's EPHT
submission portal. Users should always check the outputs with the EPHT test
submission portal first.
Users are expected to start with a standard dataframe because the XML
requirements change based on the facility type (Hospital vs Emergency
Department) even though the variables and disease are the same. Users trade
some freedom in naming conventions and in return distiller abstracts away
the xml naming gymnastics. By having a single set of column names, users can
keep all their data in one place and do all the required wrangling on a
single set of data, all at once, and then use whatever package they wish to
split out the master data and iterate over it with distiller.
Users have the option to check their submission at time of XML creation and
get instant feedback on the possible validity of their submission. Users can
further refine the returned xml document with their choice of package such as
xml2,
XML and friends.
When satisfied with the data product users will need to print the XML
document to a file and then submit to the CDC like they usually would."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">distiller</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/asenetcky/distiller/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create an XML document with user-provided data and submission metadata</h1>
      <small class="dont-index">Source: <a href="https://github.com/asenetcky/distiller/blob/main/R/make_xml_document.R" class="external-link"><code>R/make_xml_document.R</code></a></small>
      <div class="d-none name"><code>make_xml_document.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This is the core function of <code>distiller</code>. It takes in a user-provided
dataframe with the expected columns and a set of metadata about the
submission. It then jumps through the XML hoops for the user and distills it
all down to an XML document that can be submitted to the CDC's EPHT
submission portal. Users should <em>always</em> check the outputs with the EPHT test
submission portal first.</p>
<p>Users are expected to start with a standard dataframe because the XML
requirements change based on the facility type (Hospital vs Emergency
Department) even though the variables and disease are the same. Users trade
some freedom in naming conventions and in return <code>distiller</code> abstracts away
the xml naming gymnastics. By having a single set of column names, users can
keep all their data in one place and do all the required wrangling on a
single set of data, all at once, and then use whatever package they wish to
split out the master data and iterate over it with <code>distiller</code>.</p>
<p>Users have the option to check their submission at time of XML creation and
get instant feedback on the possible validity of their submission. Users can
further refine the returned xml document with their choice of package such as
<a href="https://cran.r-project.org/web/packages/xml2/index.html" class="external-link">xml2</a>,
<a href="https://cran.r-project.org/web/packages/XML/index.html" class="external-link">XML</a> and friends.
When satisfied with the data product users will need to print the XML
document to a file and then submit to the CDC like they usually would.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">make_xml_document</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">content_group_id</span>,</span>
<span>  <span class="va">mcn</span>,</span>
<span>  <span class="va">jurisdiction_code</span>,</span>
<span>  <span class="va">state_fips_code</span>,</span>
<span>  <span class="va">submitter_email</span>,</span>
<span>  <span class="va">submitter_name</span>,</span>
<span>  <span class="va">submitter_title</span>,</span>
<span>  check_first <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Pre-wrangled Dataframe.</p></dd>


<dt id="arg-content-group-id">content_group_id<a class="anchor" aria-label="anchor" href="#arg-content-group-id"></a></dt>
<dd><p>Code that identifies the content found in EPHT
documentation.</p></dd>


<dt id="arg-mcn">mcn<a class="anchor" aria-label="anchor" href="#arg-mcn"></a></dt>
<dd><p>Metadata Control Number provided by EPHT.</p></dd>


<dt id="arg-jurisdiction-code">jurisdiction_code<a class="anchor" aria-label="anchor" href="#arg-jurisdiction-code"></a></dt>
<dd><p>Two-letter state abbreviation for the submitter
state.</p></dd>


<dt id="arg-state-fips-code">state_fips_code<a class="anchor" aria-label="anchor" href="#arg-state-fips-code"></a></dt>
<dd><p>FIPS code of the submitter state.</p></dd>


<dt id="arg-submitter-email">submitter_email<a class="anchor" aria-label="anchor" href="#arg-submitter-email"></a></dt>
<dd><p>Email of person submitting data to EPHT.</p></dd>


<dt id="arg-submitter-name">submitter_name<a class="anchor" aria-label="anchor" href="#arg-submitter-name"></a></dt>
<dd><p>First and last name of person submitting data to EPHT.</p></dd>


<dt id="arg-submitter-title">submitter_title<a class="anchor" aria-label="anchor" href="#arg-submitter-title"></a></dt>
<dd><p>Title of person submitting data to EPHT.</p></dd>


<dt id="arg-check-first">check_first<a class="anchor" aria-label="anchor" href="#arg-check-first"></a></dt>
<dd><p>Check the validity of your EPHT submission.
Default is <code>FALSE</code>, if set to <code>TRUE</code> then <code>distiller</code> will run through its
suite of metadata and data checks.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>XML document object</p>
    </div>
    <div class="section level2">
    <h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a></h2>
    <p>Users are expected to wrangle, aggregate and otherwise implement the logic
expected by EPHT themselves. <code>distiller</code> will not handle that step, though it
does provides some helpers: <code><a href="collapse_race.html">collapse_race()</a></code>, <a href="collapse_ethnicity.html">collapse_ethnicity</a>, and
<a href="make_months_worse.html">make_months_worse</a>.</p>
<p>In order for <code>distiller</code> to work properly there are some expectations about
the data that must be met:</p><ul><li><p>The data must be a dataframe or tibble</p></li>
<li><p>For all <code>content_group_id</code> The data must have the following columns:
(in any order):</p><ul><li><p>month: character - acceptable values: "01", "02", "03" ... "12"</p></li>
<li><p>agegroup: numeric - acceptable values: 1-19</p></li>
<li><p>county: character - string length of 5, unless unknown, then county = "U"</p></li>
<li><p>ethnicity: character - acceptable values: "H", "NH", "U"</p></li>
<li><p>race: character - acceptable values: "W", "B", "O", "U"</p></li>
<li><p>health_outcome_id: numeric - acceptable values: 1-5</p></li>
<li><p>sex: character - acceptable values: "M", "F", "U"</p></li>
<li><p>year: numeric - acceptable values: 2001-9999</p></li>
<li><p>monthly_count: numeric - acceptable values: &gt;0 and <em>no</em> missing values</p></li>
</ul></li>
<li><p>For <code>content_group_id</code> "CO-ED" and "CO-HOSP" the data must have the
additional columns:</p><ul><li><p>fire_count: numeric - acceptable values: &gt;0 and <em>no</em> missing values</p></li>
<li><p>nonfire_count: numeric - acceptable values: &gt;0 and <em>no</em> missing values</p></li>
<li><p>unknown_count: numeric - acceptable values: &gt;0 and <em>no</em> missing values</p></li>
</ul></li>
</ul></div>
    <div class="section level2">
    <h2 id="content-group-identifier">Content Group Identifier<a class="anchor" aria-label="anchor" href="#content-group-identifier"></a></h2>
    <p>The Content Group Identifier is the ID expected to be used by EPHT. It is
a combination of the the disease and facility type.  Details on which ID to
use can be found in the how-to-guides provided by EPHT.</p>
<p><code>content_group_id</code> must belong to one of the following:</p><ul><li><p>"AS-ED", "AS-HOSP"</p></li>
<li><p>"MI-HOSP"</p></li>
<li><p>"CO-ED", "CO-HOSP"</p></li>
<li><p>"HEAT-ED", "HEAT-HOSP"</p></li>
<li><p>"COPD-ED", "COPD-HOSP"</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="metadata-control-number">Metadata Control Number<a class="anchor" aria-label="anchor" href="#metadata-control-number"></a></h2>
    <p>The Metadata control number (mcn) is provided by the EPHT and is used to identify
the dataset and its content.  In order to submit data users will already
have a set of these.</p>
    </div>
    <div class="section level2">
    <h2 id="submission-check">Submission Check<a class="anchor" aria-label="anchor" href="#submission-check"></a></h2>
    <p>If users set <code>check_first</code> = <code>TRUE</code> in <code>make_xml_document()</code> or runs
<a href="check_submission.html">check_submission</a> or any of the other <code>check_* functions</code> then the a suite
of checks is run against the metadata, data structure and data content.
Please note that users do not need to run the whole suite of checks, they can
run each function piecemeal on their data as it is being prepared.</p>
<p><a href="check_submission.html">check_submission</a> is called which is a wrapper around
the following functions:</p><ul><li><p><a href="check_content_group_id.html">check_content_group_id</a></p></li>
<li><p><a href="check_data.html">check_data</a></p></li>
<li><p><a href="check_data_content.html">check_data_content</a></p></li>
<li><p><a href="check_jurisdiction_code.html">check_jurisdiction_code</a></p></li>
<li><p><a href="check_mcn.html">check_mcn</a></p></li>
<li><p><a href="check_state_fips_code.html">check_state_fips_code</a></p></li>
<li><p><a href="check_submitter_email.html">check_submitter_email</a></p></li>
<li><p><a href="check_submitter_name.html">check_submitter_name</a></p></li>
<li><p><a href="check_submitter_title.html">check_submitter_title</a></p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other xml:
<code><a href="make_dataset_node.html">make_dataset_node</a>()</code>,
<code><a href="make_header_node.html">make_header_node</a>()</code>,
<code><a href="make_root_element.html">make_root_element</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="va">mtcars</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    month <span class="op">=</span> <span class="va">mpg</span>,</span></span>
<span class="r-in"><span>    agegroup <span class="op">=</span> <span class="va">cyl</span>,</span></span>
<span class="r-in"><span>    county <span class="op">=</span> <span class="va">disp</span>,</span></span>
<span class="r-in"><span>    ethnicity <span class="op">=</span> <span class="va">hp</span>,</span></span>
<span class="r-in"><span>    health_outcome_id <span class="op">=</span> <span class="va">drat</span>,</span></span>
<span class="r-in"><span>    monthly_count <span class="op">=</span> <span class="va">wt</span>,</span></span>
<span class="r-in"><span>    race <span class="op">=</span> <span class="va">qsec</span>,</span></span>
<span class="r-in"><span>    sex <span class="op">=</span> <span class="va">vs</span>,</span></span>
<span class="r-in"><span>    year <span class="op">=</span> <span class="va">am</span></span></span>
<span class="r-in"><span>  <span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">gear</span>, <span class="va">carb</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">content_group_id</span> <span class="op">&lt;-</span> <span class="st">"AS-HOSP"</span></span></span>
<span class="r-in"><span><span class="va">mcn</span> <span class="op">&lt;-</span> <span class="st">"1234-1234-1234-1234-1234"</span></span></span>
<span class="r-in"><span><span class="va">jurisdiction_code</span> <span class="op">&lt;-</span> <span class="st">"two_letter_code"</span></span></span>
<span class="r-in"><span><span class="va">state_fips_code</span> <span class="op">&lt;-</span> <span class="st">"1234"</span></span></span>
<span class="r-in"><span><span class="va">submitter_email</span> <span class="op">&lt;-</span> <span class="st">"submitter@email.com"</span></span></span>
<span class="r-in"><span><span class="va">submitter_name</span> <span class="op">&lt;-</span> <span class="st">"Submitter Name"</span></span></span>
<span class="r-in"><span><span class="va">submitter_title</span> <span class="op">&lt;-</span> <span class="st">"Submitter Title"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">doc</span> <span class="op">&lt;-</span> <span class="fu">make_xml_document</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">data</span>,</span></span>
<span class="r-in"><span>  <span class="va">content_group_id</span>,</span></span>
<span class="r-in"><span>  <span class="va">mcn</span>,</span></span>
<span class="r-in"><span>  <span class="va">jurisdiction_code</span>,</span></span>
<span class="r-in"><span>  <span class="va">state_fips_code</span>,</span></span>
<span class="r-in"><span>  <span class="va">submitter_email</span>,</span></span>
<span class="r-in"><span>  <span class="va">submitter_name</span>,</span></span>
<span class="r-in"><span>  <span class="va">submitter_title</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">doc</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {xml_document}</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;HospitalizationData schemaLocation="http://www.ephtn.org/NCDM/PH/HospitalizationData ephtn-ph-HospitalizationData.xsd" xmlns="http://www.ephtn.org/NCDM/PH/HospitalizationData" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] &lt;Header&gt;\n  &lt;MCN&gt;1234-1234-1234-1234-1234&lt;/MCN&gt;\n  &lt;JurisdictionCode&gt;two_ ...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2] &lt;Dataset&gt;\n  &lt;Row&gt;\n    &lt;RowIdentifier&gt;1&lt;/RowIdentifier&gt;\n    &lt;AdmissionM ...</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Alexander Senetcky.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

